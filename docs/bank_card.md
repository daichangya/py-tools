# 银行卡信息查询工具

## 体验地址

您可以在以下地址体验此工具：[http://api.zthinker.com/](http://api.zthinker.com/)

## 功能概述

银行卡信息查询工具是一个用于验证银行卡号有效性并查询银行卡详细信息的应用。用户可以输入银行卡号，系统会自动验证卡号的有效性，并返回该卡的发卡行、卡类型等详细信息。

## 主要功能

- 验证银行卡号的有效性（使用Luhn算法）
- 识别银行卡的发卡行（支持国内主要银行）
- 确定银行卡类型（信用卡、储蓄卡等）
- 提供银行的详细信息（总部地址、客服电话等）
- 银行卡号脱敏处理，保护用户隐私

## 使用方法

### Web界面使用

1. 访问银行卡查询页面
2. 输入要查询的银行卡号
3. 点击"查询"按钮
4. 查看返回的银行卡详细信息

### API调用

```
GET /api/bank/query?card_no=6222021234567890123
```

## 技术实现

### 核心功能

1. **银行卡号验证**：使用Luhn算法验证银行卡号的有效性
2. **BIN码识别**：通过银行卡号前6位（BIN码）识别发卡行和卡类型
3. **银行信息查询**：提供银行的详细信息，包括总部地址、客服电话等
4. **卡号脱敏**：对银行卡号进行脱敏处理，只显示前6位和后4位

### Luhn算法

Luhn算法（又称模10算法）是一种简单的校验和算法，主要用于验证银行卡号等号码的有效性：

```python
def validate_card(card_no: str) -> bool:
    """使用Luhn算法验证银行卡号"""
    if not card_no or not card_no.isdigit():
        return False

    digits = [int(x) for x in card_no]
    for i in range(len(digits)-2, -1, -2):
        digits[i] *= 2
        if digits[i] > 9:
            digits[i] -= 9
    return sum(digits) % 10 == 0
```

### BIN码识别

BIN（Bank Identification Number）是银行卡号的前6位，用于识别发卡行和卡类型：

1. 系统维护一个BIN码数据库，包含标准BIN信息和扩展BIN信息
2. 查询时，先检查扩展BIN数据库，再检查标准BIN数据库
3. 如果本地数据库没有匹配信息，则调用支付宝API进行查询
4. 查询成功后，将新的BIN信息保存到扩展BIN数据库中，以便下次使用

### 银行卡类型

系统支持识别以下银行卡类型：

| 代码 | 卡类型 |
|------|------|
| CC | 信用卡 |
| DC | 储蓄卡 |
| DCC | 借记卡 |
| JC | 准贷记卡 |
| PC | 预付卡 |
| BC | 商务卡 |
| GC | 礼品卡 |
| SC | 学生卡 |
| EC | 电子现金卡 |
| ETC | ETC卡 |
| HC | 健康卡 |
| FC | 金融IC卡 |

### 数据来源

系统使用多种数据源来提供银行卡信息：

1. **本地BIN数据库**：包含常见银行卡BIN码信息
2. **支付宝API**：当本地数据库无法识别时，使用支付宝API进行查询
3. **银行信息数据库**：包含银行的详细信息，如总部地址、客服电话等

## 文件结构

- `app/plugins/bank_plugin.py`：插件主类，处理路由和请求
- `app/services/bank_service.py`：服务类，实现银行卡查询的核心功能
- `app/utils/bank_data.py`：数据管理类，负责加载和管理银行卡相关数据
- `app/static/bank/bank_list.csv`：银行列表数据
- `app/static/bank/bank.json`：银行详细信息数据
- `app/static/bank/bin.csv`：标准BIN码数据
- `app/static/bank/binex.csv`：扩展BIN码数据（动态更新）

## API接口

### 查询银行卡信息

**请求**：
```
GET /api/bank/query?card_no={银行卡号}
```

**参数**：
- `card_no`：要查询的银行卡号

**响应**：
```json
{
  "success": true,
  "data": {
    "card_no": "6222021234567890123",
    "masked_no": "622202******0123",
    "valid": true,
    "bank_code": "ICBC",
    "bank": "中国工商银行",
    "type": "储蓄卡",
    "length": 19,
    "bank_info": {
      "名称": "中国工商银行",
      "总部地址": "北京市西城区复兴门内大街55号",
      "客服电话": "95588",
      "网址": "http://www.icbc.com.cn",
      "成立日期": "1984年1月1日"
    },
    "bank_img": "https://apimg.alipay.com/combo.png?d=cashier&t=ICBC"
  }
}
```

### 获取银行列表

**请求**：
```
GET /api/bank/list
```

**响应**：
```json
{
  "success": true,
  "data": {
    "ICBC": "中国工商银行",
    "ABC": "中国农业银行",
    "BOC": "中国银行",
    "CCB": "中国建设银行",
    "CMB": "招商银行",
    "CMBC": "中国民生银行",
    "PSBC": "中国邮政储蓄银行",
    "SPDB": "上海浦东发展银行",
    "COMM": "交通银行",
    "CIB": "兴业银行"
  }
}
```

## 注意事项

1. 银行卡号是敏感信息，系统会对卡号进行脱敏处理，只显示前6位和后4位
2. 系统不会存储用户输入的完整银行卡号，保护用户隐私
3. BIN码数据库可能不包含所有银行卡的信息，特别是新发行的银行卡
4. 支付宝API可能会有调用限制，如果频繁查询可能会被限制访问
5. 银行卡验证只能确认卡号格式是否有效，不能确认卡是否真实存在或是否可用

## 未来计划

1. 支持更多国际银行卡的识别
2. 添加银行卡安全评估功能
3. 提供银行网点查询功能
4. 增加银行卡优惠信息查询
5. 支持银行卡号OCR识别，方便用户输入
